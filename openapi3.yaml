openapi: 3.0.1
info:
  title: 3d-extractable-management-bff
  description: Manage extractable records with validation and audit logging
  version: 1.0.0
  license:
    name: 3d-extractable-management repo link
    url: https://github.com/MapColonies/3d-extractable-management/

security: []

tags:
  - name: records
    description: Record extractability management
  - name: users
    description: User authentication and validation

paths:
  /records:
    get:
      tags:
        - records
      summary: Get all extractable records
      operationId: getRecords
      responses:
        '200':
          description: List of extractable records (empty array if none found)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/extractable-record'
              examples:
                empty:
                  summary: No records
                  value: []
                withRecords:
                  summary: Some records
                  value:
                    - id: 'abc123'
                      recordName: rec_A
                      authorizedBy: john_doe
                      authorizedAt: '2026-01-16T12:00:00Z'
                      data:
                        productType: 3DPhotoRealistic
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                bad_request:
                  summary: Bad request
                  value:
                    message: 'Bad request – invalid query or parameters'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected server error
                  value:
                    message: 'Internal server error, please try again later'

  /records/{recordName}:
    get:
      tags:
        - records
      summary: Get extractable record by record name
      operationId: getRecord
      parameters:
        - name: recordName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Record found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/extractable-record'
              examples:
                found:
                  summary: Record exists
                  value:
                    id: 'abc123'
                    recordName: rec_A
                    authorizedBy: john_doe
                    authorizedAt: '2026-01-16T12:00:00Z'
                    data:
                      productType: 3DPhotoRealistic
        '404':
          description: Record not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                not_found:
                  summary: Record does not exist
                  value:
                    message: "Record with name 'rec_X' not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected server error
                  value:
                    message: 'Internal server error, please try again later'

    post:
      tags:
        - records
      summary: Create extractable record
      operationId: createRecord
      parameters:
        - name: recordName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - authorizedBy
              properties:
                username:
                  type: string
                password:
                  type: string
                authorizedBy:
                  type: string
                  description: 'User authorizing this record creation'
                data:
                  type: object
                  description: 'Optional metadata for the record'
      responses:
        '201':
          description: Record created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/extractable-record'
              examples:
                created:
                  summary: Record created
                  value:
                    id: 'abc123'
                    recordName: rec_A
                    authorizedBy: john_doe
                    authorizedAt: '2026-01-16T12:00:00Z'
                    data:
                      productType: 3DPhotoRealistic
        '400':
          description: Validation failed – call POST /records/validate first
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                validation_failed:
                  summary: Validation missing
                  value:
                    message: 'Cannot create record – validation required'
        '401':
          description: Unauthorized – invalid username or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                unauthorized:
                  summary: Invalid credentials
                  value:
                    isValid: false
                    message: 'Invalid username or password'
                    code: 'INVALID_CREDENTIALS'
        '404':
          description: Record not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                record_not_found:
                  summary: Record does not exist
                  value:
                    isValid: false
                    message: "Record with name 'rec_X' not found"
                    code: 'INVALID_RECORD_NAME'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected error
                  value:
                    message: 'Internal server error, please try again later'

    delete:
      tags:
        - records
      summary: Delete extractable record
      operationId: deleteRecord
      parameters:
        - name: recordName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - authorizedBy
              properties:
                username:
                  type: string
                password:
                  type: string
                authorizedBy:
                  type: string
                  description: 'User authorizing this deletion'
                data:
                  type: object
                  description: 'Optional metadata related to deletion'
      responses:
        '204':
          description: Record deleted successfully
        '404':
          description: Record not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                not_found:
                  summary: Record missing
                  value:
                    message: "Cannot delete – record 'rec_X' not found"
        '400':
          description: Validation failed – deletion not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                deletion_failed:
                  summary: Validation failed
                  value:
                    message: 'Deletion not allowed for this record'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                unauthorized:
                  summary: Invalid credentials
                  value:
                    isValid: false
                    message: 'Invalid username or password'
                    code: 'INVALID_CREDENTIALS'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected server error
                  value:
                    message: 'Internal server error, please try again later'

  /records/validateCreate:
    post:
      tags:
        - records
      summary: Validate record can be created
      operationId: validateCreate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth-payload-with-record'
      responses:
        '200':
          description: Validation result for create
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                valid:
                  summary: Can create
                  value:
                    isValid: true
                    message: 'Record can be created'
        '401':
          description: Unauthorized – invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                invalid_credentials:
                  summary: Invalid credentials
                  value:
                    isValid: false
                    message: 'Invalid username or password'
                    code: 'INVALID_CREDENTIALS'
        '400':
          description: Validation failed – missing fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                missing_fields:
                  summary: Missing credentials or recordName
                  value:
                    message: 'Username, password, and recordName are required'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected server error
                  value:
                    message: 'Internal server error, please try again later'

  /records/validateDelete:
    post:
      tags:
        - records
      summary: Validate record can be deleted
      operationId: validateDelete
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth-payload-with-record'
      responses:
        '200':
          description: Validation result for delete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                valid:
                  summary: Can delete
                  value:
                    isValid: true
                    message: 'Record can be deleted'
        '401':
          description: Unauthorized – invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                invalid_credentials:
                  summary: Invalid credentials
                  value:
                    isValid: false
                    message: 'Invalid username or password'
                    code: 'INVALID_CREDENTIALS'
        '400':
          description: Validation failed – missing fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                missing_fields:
                  summary: Missing credentials or recordName
                  value:
                    message: 'Username, password, and recordName are required'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected server error
                  value:
                    message: 'Internal server error, please try again later'

  /users/validate:
    post:
      tags:
        - users
      summary: Validate a user's username and password
      operationId: validateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth-payload'
      responses:
        '200':
          description: User credentials are valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                valid:
                  summary: Credentials valid
                  value:
                    isValid: true
                    message: 'User credentials are valid'
        '400':
          description: Missing username or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                missing_fields:
                  summary: Missing credentials
                  value:
                    message: 'Username and password are required'
        '401':
          description: Unauthorized – invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/validateResponse'
              examples:
                invalid:
                  summary: Invalid credentials
                  value:
                    isValid: false
                    message: 'Invalid username or password'
                    code: 'INVALID_CREDENTIALS'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
              examples:
                internal_error:
                  summary: Unexpected server error
                  value:
                    message: 'Internal server error, please try again later'

components:
  schemas:
    error:
      type: object
      required:
        - message
      properties:
        message:
          type: string

    validateResponse:
      type: object
      required:
        - isValid
        - message
      properties:
        isValid:
          type: boolean
        message:
          type: string
        code:
          type: string
          enum:
            - MISSING_CREDENTIALS
            - INVALID_CREDENTIALS
            - INVALID_RECORD_NAME

    auth-payload:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string

    auth-payload-with-record:
      type: object
      required:
        - username
        - password
        - recordName
      properties:
        username:
          type: string
        password:
          type: string
        recordName:
          type: string

    extractable-record:
      type: object
      required:
        - id
        - recordName
        - authorizedBy
        - authorizedAt
      properties:
        id:
          type: string
        recordName:
          type: string
        authorizedBy:
          type: string
        authorizedAt:
          type: string
          format: date-time
        data:
          type: object
          description: Metadata stored in extractable_records.data
